#!/bin/bash
# Bash shell script for changing passwords

# Print ASCII art banner
echo -e "
%%%%%%%%%%%%%%%%%####%%%%##############%%%%%%%%%%%%%#**+++=================#%%%%%%%####%%%%%########
%%%%%%%%%%%##%%%%###%%%%%%###########%%%%%%%%%%%%%%###*+++=================-*%%%%####%%%%%%#########
%%%%%%%%%%%%##%%#*##%%%%%%%%########%%%%%%%%%##%%%%#**++++===============-=--+%%########%%%%########
%%%%%%%%%%%%%%%%##*#%%%%%%%%######%%%%%%%%%%%%%%%%%#**++++==============------+###########%%#%######
%%%##%%%%%%%#%%%%#**#%%%%%%%#####%%%%%%@@@@%%%%%%%##***++++==========------::--***#*****###%########
###**#########%%%####%%%%%%#####%%%%@@@@@%%%%%%%%%%##**++++=====---:----:::::--+###########%%##%####
#############%%%%%####%%%%###*##%@%%@@@@@%%%%%%%######*+++====-----::-:::::::--+############%%%%%###
##%%#%%%%%%%%%%%%%%%%%%%%%%####%@@@@@@@@@%%%%#########**++===-----:::::::::::--=##########%%%%%%%%%#
**##################%%%%%%%%%%%%@@@@@@@@%%%%##########**++===-----::-::::::::--+##########%%%%%%%%%#
*************##################%@@@@@@@@@%%%%#######***+++=====---:--:::::::---=*############%#%%###
####################%%%%%#%%%%%@@@@@@@@%%%%%%%%####*****++====-==-----::::::---++=+****#############
######################%%%%%%##%@@@@@@@@%%%%%%%%###*****++++======----:::-------+*++*++*#*#%%%%%%####
###****************############%@@@@@@@@%%%%%%%###****++++++++===----::::-----=********++#*%@@@@%%##
**************************###%%%@@@@@@@@%%%%%%%###***+*****+*+=====--::::-----=*#******+++**+@@@#%%#
*#***********************##%%##%@@@@@@@@%%%%%%#####********+======----::------*#*#******+++#*+#@@@%#
**************#%%%%%%%%%#%%#####@@@@@@%%%%%#########********+====--:::::-::--+*#*++*********#++*%@%#
*******++****%%%%%%%%%%#######*#@@@@@%%%%%%#######*#*********+*++==----------++++=*****#*****+++*@@%
*****+++++**#%%%%%%%%%%%#####***%@@@@@@@@%%######***####%%%##**+++++=====---=+++++=#+*********+++###
*********++*#%%%%%%%%%%@%###**#*%@@@@@%%@@@@%%%%##**####%%%%#**++=-=====----++**%#**+********#++++%@
+++********#%%%%%%%%%%@@%%##****%@@@@%%@@%%@@@%%%#****#%%##%@%*+=-=====-----+++=*%*+*********#++++*%
%%%%%%%%%%%%%%#%%%%%%%%%%%%#****#@%%%%%%%#%%@@@%%#++***#%%#*#**========-::-=++*#%*+**********#+++++#
+******########%%%%%%%%%%%%#****#@%%%%%%%%%@@@%%%#*+*****##***++======-::--=+#%*++***********#+++++#
%%%%%%%%%%%%%%%@@@@@%%%%%%##****#@%%%%%%%%%%%%%%%#*+++******++++++===--:--=+*+*+++***********#+++++*
%%@@@%%%@@@@@@@@@@@@@%%%%#*******@%%%%%%%%%%%%%%#*+==+++****+++============*********+******+*#++++**
%%@@@@@@@@@@@@@@@%%%@%%%%##******#%%%%%%%%%%%%@%#*=-:=++*#**+++===========*******************#+++**#
%@@@@@@@@%@@@@@@@@@@@@@%%%%%%%%#**%@%%%%%%%%@%%%#*=-:-+**###*+++=========******************+#*+**++%
@@@@@@@@@@@@@@@@@@@@@@@%%%%%%%%#***%@%%%%%%%%%%%#*++=-:++*##***+++=====+****************+***%**#*+*@
@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%%***+*@%@%%%%%%@%%##*###++****#***++====+********%#*******++#%%*#*++@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@%%##*****#@@%%%%%%%%######*++*******+=====**********@@@%%%####%%%%%%%%%@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%#*+++%@%%%%%@@%%##%%##****++*++====+***********@@@%%%%%@*@%@%%%%%%%@
@@@@@@@%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%##%%##*+****+++===+************@%@%%%@%@+@@@@%%%%%%%
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%#####*++++*#*+++=+*************@%%%%%@%*+@@@@%%%%%%%
@@@@@@@@@@@@@@%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%####*##*##***********##*****#%%%%%%#**+++**+*+++++
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%#%%###*+*************##******#@%%%%%%%*++++*********
@@@@@@@@@@@%@@@@@@%@@%%%%%%%%%@@@@@@@@@@@@@@@@%%%###***********#***###***++#%%%%%%%%%%#*++*++++*####
@@@@@@@@@@@%%%%#######%%%@@@@@@@@@@@@@@@@@@@@@@@%%%######********#####*++*%@%%%%%%%%%%%#*++*********
@@%%%%%%%%%%%%%%%#####****+++++++*##%@@@@@@@@%%%%####**+++======+**++==#@%%%%%%%%%%%%%%%%%%*********
%%%%%%%%%%%%%%%%%%%%%%%%%%%%###***+++===+*#%@@%%%%*+=--------=+*#*++==--=#%%%%%%%%%%%%%%%%%@@%###%%%
%%%#####################%%%%%%#%%%####*+++++++*%%%#+--::--=*###+========---*%%%%%%%%%%%@@@%@@@@%%%%%
###%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%###%%%#%%%%%%#*+==--=+###+========+**#*=--=*%%%%%@@@@@@@@@@%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#+======*%#*+==-====+####*+==----=#%@@@@@@%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#+==-+#%%###+=---=+####*+====++==----+#@@%##**#%%%%%%%
#####%%%%%%%%%%%%%%%%%%%###%%%%%%%%%%%%%%%%#%#*==+#%%###+=----+#%#*++====+*#%*+=--::--=+*++++++++**#
###############%%%%%%%%####%%%%%@@@@@@@@%%%###**#%@%#%%#+---=#%##*=====+#%###*+=--::::--=+***++++===
##############%###########%%%%%@@@@@@@@%%######%%@%%%%%#+=+#%%##*====+#%%##+====--:::::::---=**#*=::
##########################%%%%%@%@@@@@@%#**###%%@@%%%%###%%%%##+=-==*%%%#*+====------::::::---=*%%*+
#########################%%%%%%%@@@@@@@#***##%@@@%%%###%%%%%%%*===+#%%##*+========-----::::::-:--+*+
#########################%%%%%@@@@@@@@@@%##%%@@@@%#####%%%%%%%%**#%%%#++=======++=:-----::::::::-=++
###**###################%%%%%%@@@@@@@@@@@@@@@@@@@%%##%#%%%##%%%%%@%%%##+====*#%#*+-=====---::----+#*
"


# Print script name/status messages in blue
echo -e "\033[34m[i] James Doakes on Security\033[0m"
echo -e "\033[34m[i] Running...\033[0m"

# Reset password for every user in /etc/passwd
# Each user gets a unique random 8-character suffix
# Every password will be output to REMOVEME.txt and to the terminal
# Format: username:username-XXXXXXXX

OUTFILE="REMOVEME.txt"
: > "$OUTFILE"
chmod 600 "$OUTFILE"

cut -d: -f1 /etc/passwd | while read u; do
    p=$(tr -dc A-Za-z0-9 </dev/urandom | head -c8)
    echo $u:$u-$p | chpasswd
    echo $u:$u-$p
    echo "$u:$u-$p" >> "$OUTFILE"
done

echo -e "\033[34m[i] Set Password\033[0m"